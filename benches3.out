/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/site-packages/torch/nn/modules/transformer.py:282: UserWarning: enable_nested_tensor is True, but self.use_nested_tensor is False because encoder_layer.self_attn.batch_first was not True(use batch_first for better inference performance)
  warnings.warn(f"enable_nested_tensor is True, but self.use_nested_tensor is False because {why_not_sparsity_fast_path}")
denoiser model type: transformer
denoiser model args: {'h_dim': 512, 'ff_size': 1024, 'num_layers': 8, 'num_heads': 4, 'dropout': 0.1, 'activation': 'gelu', 'cond_mask_prob': 0.1, 'clip_dim': 512, 'history_shape': (2, 276), 'noise_shape': (1, 256)}
TRANS_ENC init
Loading denoiser checkpoint from ./mld_denoiser/mld_fps_clip_repeat_euler/checkpoint_300000.pt
vae model args: {'arch': 'all_encoder', 'ff_size': 1024, 'num_layers': 7, 'num_heads': 4, 'dropout': 0.1, 'normalize_before': False, 'activation': 'gelu', 'position_embedding': 'learned', 'latent_dim': (1, 256), 'h_dim': 256, 'nfeats': 276}
Loading vae checkpoint from ./mvae/mvae_fps_clip/checkpoint_200000.pt
latent_mean: 0.005734771955758333
latent_std: 0.8744232654571533
diffusion_args: {'diffusion_steps': 10, 'respacing': 'ddim10', 'noise_schedule': 'cosine', 'sigma_small': True}
loading mean and std from data/seq_data_zero_male/mean_std_h2_f8.pkl
# ------------------------ #
[Start] Optimizing Routine
  0%|          | 0/100 [00:00<?, ?it/s]  0%|          | 0/100 [00:04<?, ?it/s]
Traceback (most recent call last):
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/runpy.py", line 194, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/davidbl/iDART/mld/optim_scene_mld.py", line 683, in <module>
    motion_sequences, history_motion_tensor, transf_rotmat, transf_transl = optimize(
  File "/home/davidbl/iDART/mld/optim_scene_mld.py", line 471, in optimize
    sdf_values = calc_vol_sdf(scene_assets, motion_sequences, transf_rotmat, transf_transl, plot=(optim_args.visualize_sdf==1 and i+1 >= optim_steps))
  File "/home/davidbl/iDART/mld/optim_scene_mld.py", line 332, in calc_vol_sdf
    sdf_values[i_,...] = body_model.volume.query_fast(scene_points, subset_smpl_output)
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/site-packages/VolumetricSMPL/volumetric_smpl.py", line 1052, in query_fast
    self._attach_impl_code(smpl_output)
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/site-packages/VolumetricSMPL/volumetric_smpl.py", line 608, in _attach_impl_code
    self.encode_body(smpl_output)
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/site-packages/VolumetricSMPL/volumetric_smpl.py", line 581, in encode_body
    sampled_points = self.partitioner.sample_mesh_points(vertices, self.n_samples)
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/site-packages/VolumetricSMPL/volumetric_smpl.py", line 428, in sample_mesh_points
    central_points = self._sample_mesh_points(posed_vert, self.tight_face_tensor, n_tight_samples, return_normals)
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/site-packages/VolumetricSMPL/volumetric_smpl.py", line 420, in _sample_mesh_points
    samp_points = sample_points_from_meshes(meshes, n_samples, return_normals)
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/site-packages/pytorch3d/ops/sample_points_from_meshes.py", line 69, in sample_points_from_meshes
    raise ValueError("Meshes contain nan or inf.")
ValueError: Meshes contain nan or inf.

real	0m24.326s
user	0m19.506s
sys	0m4.227s
ffmpeg version 6.1.1 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 12.3.0 (conda-forge gcc 12.3.0-5)
  configuration: --prefix=/work/courses/digital_human/6/miniconda3/envs/DART --cc=/home/conda/feedstock_root/build_artifacts/ffmpeg_1706918361713/_build_env/bin/x86_64-conda-linux-gnu-cc --cxx=/home/conda/feedstock_root/build_artifacts/ffmpeg_1706918361713/_build_env/bin/x86_64-conda-linux-gnu-c++ --nm=/home/conda/feedstock_root/build_artifacts/ffmpeg_1706918361713/_build_env/bin/x86_64-conda-linux-gnu-nm --ar=/home/conda/feedstock_root/build_artifacts/ffmpeg_1706918361713/_build_env/bin/x86_64-conda-linux-gnu-ar --disable-doc --disable-openssl --enable-demuxer=dash --enable-hardcoded-tables --enable-libfreetype --enable-libharfbuzz --enable-libfontconfig --enable-libopenh264 --enable-libdav1d --enable-gnutls --enable-libmp3lame --enable-libvpx --enable-libass --enable-pthreads --enable-vaapi --enable-libopenvino --enable-gpl --enable-libx264 --enable-libx265 --enable-libaom --enable-libsvtav1 --enable-libxml2 --enable-pic --enable-shared --disable-static --enable-version3 --enable-zlib --enable-libopus --pkg-config=/home/conda/feedstock_root/build_artifacts/ffmpeg_1706918361713/_build_env/bin/pkg-config
  libavutil      58. 29.100 / 58. 29.100
  libavcodec     60. 31.102 / 60. 31.102
  libavformat    60. 16.100 / 60. 16.100
  libavdevice    60.  3.100 / 60.  3.100
  libavfilter     9. 12.100 /  9. 12.100
  libswscale      7.  5.100 /  7.  5.100
  libswresample   4. 12.100 /  4. 12.100
  libpostproc    57.  3.100 / 57.  3.100
Input #0, image2, from 'bin/imgs/sdf-points-0-%d.png':
  Duration: 00:00:02.50, start: 0.000000, bitrate: N/A
  Stream #0:0: Video: png, rgba(pc, gbr/unknown/unknown), 1000x800 [SAR 3937:3937 DAR 5:4], 10 fps, 10 tbr, 10 tbn
Stream mapping:
  Stream #0:0 -> #0:0 (png (native) -> h264 (libx264))
Press [q] to stop, [?] for help
[libx264 @ 0x6395e12f6c00] using SAR=1/1
[libx264 @ 0x6395e12f6c00] using cpu capabilities: MMX2 SSE2Fast SSSE3 SSE4.2 AVX FMA3 BMI2 AVX2
[libx264 @ 0x6395e12f6c00] profile High, level 3.1, 4:2:0, 8-bit
[libx264 @ 0x6395e12f6c00] 264 - core 164 r3095 baee400 - H.264/MPEG-4 AVC codec - Copyleft 2003-2022 - http://www.videolan.org/x264.html - options: cabac=1 ref=3 deblock=1:0:0 analyse=0x3:0x113 me=hex subme=7 psy=1 psy_rd=1.00:0.00 mixed_ref=1 me_range=16 chroma_me=1 trellis=1 8x8dct=1 cqm=0 deadzone=21,11 fast_pskip=1 chroma_qp_offset=-2 threads=3 lookahead_threads=1 sliced_threads=0 nr=0 decimate=1 interlaced=0 bluray_compat=0 constrained_intra=0 bframes=3 b_pyramid=2 b_adapt=1 b_bias=0 direct=1 weightb=1 open_gop=0 weightp=2 keyint=250 keyint_min=10 scenecut=40 intra_refresh=0 rc_lookahead=40 rc=crf mbtree=1 crf=23.0 qcomp=0.60 qpmin=0 qpmax=69 qpstep=4 ip_ratio=1.40 aq=1:1.00
Output #0, mp4, to 'bin/result/optim_walk_3.mp4':
  Metadata:
    encoder         : Lavf60.16.100
  Stream #0:0: Video: h264 (avc1 / 0x31637661), yuv420p(tv, progressive), 1000x800 [SAR 1:1 DAR 5:4], q=2-31, 10 fps, 10240 tbn
    Metadata:
      encoder         : Lavc60.31.102 libx264
    Side data:
      cpb: bitrate max/min/avg: 0/0/0 buffer size: 0 vbv_delay: N/A
frame=    0 fps=0.0 q=0.0 size=       0kB time=N/A bitrate=N/A speed=N/A    [out#0/mp4 @ 0x6395e12f4fc0] video:169kB audio:0kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.669322%
frame=   25 fps=0.0 q=-1.0 Lsize=     171kB time=00:00:02.20 bitrate= 635.0kbits/s speed=2.33x    
[libx264 @ 0x6395e12f6c00] frame I:1     Avg QP:17.96  size: 60054
[libx264 @ 0x6395e12f6c00] frame P:9     Avg QP:19.95  size:  8465
[libx264 @ 0x6395e12f6c00] frame B:15    Avg QP:23.66  size:  2435
[libx264 @ 0x6395e12f6c00] consecutive B-frames: 12.0% 16.0% 24.0% 48.0%
[libx264 @ 0x6395e12f6c00] mb I  I16..4:  4.3% 67.3% 28.4%
[libx264 @ 0x6395e12f6c00] mb P  I16..4:  0.2%  0.9%  0.4%  P16..4: 10.0%  3.7%  2.5%  0.0%  0.0%    skip:82.4%
[libx264 @ 0x6395e12f6c00] mb B  I16..4:  0.0%  0.4%  0.0%  B16..8: 12.6%  2.6%  0.8%  direct: 1.1%  skip:82.5%  L0:38.9% L1:54.3% BI: 6.8%
[libx264 @ 0x6395e12f6c00] 8x8 transform intra:67.9% inter:37.0%
[libx264 @ 0x6395e12f6c00] coded y,uvDC,uvAC intra: 22.6% 11.7% 10.8% inter: 3.4% 2.7% 1.3%
[libx264 @ 0x6395e12f6c00] i16 v,h,dc,p: 58% 20% 22%  0%
[libx264 @ 0x6395e12f6c00] i8 v,h,dc,ddl,ddr,vr,hd,vl,hu: 54%  7% 35%  1%  1%  1%  1%  1%  0%
[libx264 @ 0x6395e12f6c00] i4 v,h,dc,ddl,ddr,vr,hd,vl,hu: 40% 27% 11%  4%  2%  3%  3%  8%  2%
[libx264 @ 0x6395e12f6c00] i8c dc,h,v,p: 92%  2%  4%  2%
[libx264 @ 0x6395e12f6c00] Weighted P-Frames: Y:0.0% UV:0.0%
[libx264 @ 0x6395e12f6c00] ref P L0: 59.7% 16.2% 14.7%  9.5%
[libx264 @ 0x6395e12f6c00] ref B L0: 81.5% 15.2%  3.3%
[libx264 @ 0x6395e12f6c00] ref B L1: 95.7%  4.3%
[libx264 @ 0x6395e12f6c00] kb/s:552.86
[INFO] Video saved as 'bin/result/optim_walk_3.mp4'.
/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/site-packages/torch/nn/modules/transformer.py:282: UserWarning: enable_nested_tensor is True, but self.use_nested_tensor is False because encoder_layer.self_attn.batch_first was not True(use batch_first for better inference performance)
  warnings.warn(f"enable_nested_tensor is True, but self.use_nested_tensor is False because {why_not_sparsity_fast_path}")
denoiser model type: transformer
denoiser model args: {'h_dim': 512, 'ff_size': 1024, 'num_layers': 8, 'num_heads': 4, 'dropout': 0.1, 'activation': 'gelu', 'cond_mask_prob': 0.1, 'clip_dim': 512, 'history_shape': (2, 276), 'noise_shape': (1, 256)}
TRANS_ENC init
Loading denoiser checkpoint from ./mld_denoiser/mld_fps_clip_repeat_euler/checkpoint_300000.pt
vae model args: {'arch': 'all_encoder', 'ff_size': 1024, 'num_layers': 7, 'num_heads': 4, 'dropout': 0.1, 'normalize_before': False, 'activation': 'gelu', 'position_embedding': 'learned', 'latent_dim': (1, 256), 'h_dim': 256, 'nfeats': 276}
Loading vae checkpoint from ./mvae/mvae_fps_clip/checkpoint_200000.pt
latent_mean: 0.005734771955758333
latent_std: 0.8744232654571533
diffusion_args: {'diffusion_steps': 10, 'respacing': 'ddim10', 'noise_schedule': 'cosine', 'sigma_small': True}
loading mean and std from data/seq_data_zero_male/mean_std_h2_f8.pkl
# ------------------------ #
[Start] Optimizing Routine
  0%|          | 0/100 [00:00<?, ?it/s]  0%|          | 0/100 [00:01<?, ?it/s]
Traceback (most recent call last):
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/runpy.py", line 194, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/davidbl/iDART/mld/optim_scene_mld.py", line 683, in <module>
    motion_sequences, history_motion_tensor, transf_rotmat, transf_transl = optimize(
  File "/home/davidbl/iDART/mld/optim_scene_mld.py", line 471, in optimize
    sdf_values = calc_vol_sdf(scene_assets, motion_sequences, transf_rotmat, transf_transl, plot=(optim_args.visualize_sdf==1 and i+1 >= optim_steps))
  File "/home/davidbl/iDART/mld/optim_scene_mld.py", line 292, in calc_vol_sdf
    smpl_output = body_model(betas=betas,
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/work/courses/digital_human/6/miniconda3/envs/DART/lib/python3.8/site-packages/smplx/body_models.py", line 1208, in forward
    full_pose = torch.cat([global_orient.reshape(-1, 1, 3),
RuntimeError: Sizes of tensors must match except in dimension 1. Expected size 208 but got size 784 for tensor number 2 in the list.

real	0m22.580s
user	0m17.663s
sys	0m4.541s
ffmpeg version 6.1.1 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 12.3.0 (conda-forge gcc 12.3.0-5)
  configuration: --prefix=/work/courses/digital_human/6/miniconda3/envs/DART --cc=/home/conda/feedstock_root/build_artifacts/ffmpeg_1706918361713/_build_env/bin/x86_64-conda-linux-gnu-cc --cxx=/home/conda/feedstock_root/build_artifacts/ffmpeg_1706918361713/_build_env/bin/x86_64-conda-linux-gnu-c++ --nm=/home/conda/feedstock_root/build_artifacts/ffmpeg_1706918361713/_build_env/bin/x86_64-conda-linux-gnu-nm --ar=/home/conda/feedstock_root/build_artifacts/ffmpeg_1706918361713/_build_env/bin/x86_64-conda-linux-gnu-ar --disable-doc --disable-openssl --enable-demuxer=dash --enable-hardcoded-tables --enable-libfreetype --enable-libharfbuzz --enable-libfontconfig --enable-libopenh264 --enable-libdav1d --enable-gnutls --enable-libmp3lame --enable-libvpx --enable-libass --enable-pthreads --enable-vaapi --enable-libopenvino --enable-gpl --enable-libx264 --enable-libx265 --enable-libaom --enable-libsvtav1 --enable-libxml2 --enable-pic --enable-shared --disable-static --enable-version3 --enable-zlib --enable-libopus --pkg-config=/home/conda/feedstock_root/build_artifacts/ffmpeg_1706918361713/_build_env/bin/pkg-config
  libavutil      58. 29.100 / 58. 29.100
  libavcodec     60. 31.102 / 60. 31.102
  libavformat    60. 16.100 / 60. 16.100
  libavdevice    60.  3.100 / 60.  3.100
  libavfilter     9. 12.100 /  9. 12.100
  libswscale      7.  5.100 /  7.  5.100
  libswresample   4. 12.100 /  4. 12.100
  libpostproc    57.  3.100 / 57.  3.100
Input #0, image2, from 'bin/imgs/sdf-points-0-%d.png':
  Duration: 00:00:02.50, start: 0.000000, bitrate: N/A
  Stream #0:0: Video: png, rgba(pc, gbr/unknown/unknown), 1000x800 [SAR 3937:3937 DAR 5:4], 10 fps, 10 tbr, 10 tbn
Stream mapping:
  Stream #0:0 -> #0:0 (png (native) -> h264 (libx264))
Press [q] to stop, [?] for help
[libx264 @ 0x61c758249c00] using SAR=1/1
[libx264 @ 0x61c758249c00] using cpu capabilities: MMX2 SSE2Fast SSSE3 SSE4.2 AVX FMA3 BMI2 AVX2
[libx264 @ 0x61c758249c00] profile High, level 3.1, 4:2:0, 8-bit
[libx264 @ 0x61c758249c00] 264 - core 164 r3095 baee400 - H.264/MPEG-4 AVC codec - Copyleft 2003-2022 - http://www.videolan.org/x264.html - options: cabac=1 ref=3 deblock=1:0:0 analyse=0x3:0x113 me=hex subme=7 psy=1 psy_rd=1.00:0.00 mixed_ref=1 me_range=16 chroma_me=1 trellis=1 8x8dct=1 cqm=0 deadzone=21,11 fast_pskip=1 chroma_qp_offset=-2 threads=3 lookahead_threads=1 sliced_threads=0 nr=0 decimate=1 interlaced=0 bluray_compat=0 constrained_intra=0 bframes=3 b_pyramid=2 b_adapt=1 b_bias=0 direct=1 weightb=1 open_gop=0 weightp=2 keyint=250 keyint_min=10 scenecut=40 intra_refresh=0 rc_lookahead=40 rc=crf mbtree=1 crf=23.0 qcomp=0.60 qpmin=0 qpmax=69 qpstep=4 ip_ratio=1.40 aq=1:1.00
Output #0, mp4, to 'bin/result/optim_run_3.mp4':
  Metadata:
    encoder         : Lavf60.16.100
  Stream #0:0: Video: h264 (avc1 / 0x31637661), yuv420p(tv, progressive), 1000x800 [SAR 1:1 DAR 5:4], q=2-31, 10 fps, 10240 tbn
    Metadata:
      encoder         : Lavc60.31.102 libx264
    Side data:
      cpb: bitrate max/min/avg: 0/0/0 buffer size: 0 vbv_delay: N/A
frame=    0 fps=0.0 q=0.0 size=       0kB time=N/A bitrate=N/A speed=N/A    [out#0/mp4 @ 0x61c758247fc0] video:169kB audio:0kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.669322%
frame=   25 fps=0.0 q=-1.0 Lsize=     171kB time=00:00:02.20 bitrate= 635.0kbits/s speed=3.38x    
[libx264 @ 0x61c758249c00] frame I:1     Avg QP:17.96  size: 60054
[libx264 @ 0x61c758249c00] frame P:9     Avg QP:19.95  size:  8465
[libx264 @ 0x61c758249c00] frame B:15    Avg QP:23.66  size:  2435
[libx264 @ 0x61c758249c00] consecutive B-frames: 12.0% 16.0% 24.0% 48.0%
[libx264 @ 0x61c758249c00] mb I  I16..4:  4.3% 67.3% 28.4%
[libx264 @ 0x61c758249c00] mb P  I16..4:  0.2%  0.9%  0.4%  P16..4: 10.0%  3.7%  2.5%  0.0%  0.0%    skip:82.4%
[libx264 @ 0x61c758249c00] mb B  I16..4:  0.0%  0.4%  0.0%  B16..8: 12.6%  2.6%  0.8%  direct: 1.1%  skip:82.5%  L0:38.9% L1:54.3% BI: 6.8%
[libx264 @ 0x61c758249c00] 8x8 transform intra:67.9% inter:37.0%
[libx264 @ 0x61c758249c00] coded y,uvDC,uvAC intra: 22.6% 11.7% 10.8% inter: 3.4% 2.7% 1.3%
[libx264 @ 0x61c758249c00] i16 v,h,dc,p: 58% 20% 22%  0%
[libx264 @ 0x61c758249c00] i8 v,h,dc,ddl,ddr,vr,hd,vl,hu: 54%  7% 35%  1%  1%  1%  1%  1%  0%
[libx264 @ 0x61c758249c00] i4 v,h,dc,ddl,ddr,vr,hd,vl,hu: 40% 27% 11%  4%  2%  3%  3%  8%  2%
[libx264 @ 0x61c758249c00] i8c dc,h,v,p: 92%  2%  4%  2%
[libx264 @ 0x61c758249c00] Weighted P-Frames: Y:0.0% UV:0.0%
[libx264 @ 0x61c758249c00] ref P L0: 59.7% 16.2% 14.7%  9.5%
[libx264 @ 0x61c758249c00] ref B L0: 81.5% 15.2%  3.3%
[libx264 @ 0x61c758249c00] ref B L1: 95.7%  4.3%
[libx264 @ 0x61c758249c00] kb/s:552.86
[INFO] Video saved as 'bin/result/optim_run_3.mp4'.
